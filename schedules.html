<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NASCAR Schedule</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background-color: #111;
    color: #eee;
    margin: 0;
    padding: 1rem;
  }
  #header {
    position: sticky;
    top: 0;
    background-color: #111;
    z-index: 100;
    padding: 0.5rem 0;
    border-bottom: 1px solid #333;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    text-align: center;
  }
  h2 {
    margin: 0.5rem 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid #333;
    padding: 0.4rem;
    text-align: center;
  }
  th {
    background-color: #222;
    color: #ffcc00;
  }
  tr:nth-child(even) { background-color: #1a1a1a; }
  tr:hover { background-color: #333; }

  /* Navigation bar */
  .nav-bar {
    display: flex;
    justify-content: center;
    margin-top: 0.5rem;
    gap: 15px;
  }
  .nav-link {
    color: #ffcc00;
    text-decoration: none;
    font-weight: bold;
    padding: 5px 12px;
    border: 1px solid transparent;
    border-radius: 4px;
    transition: all 0.2s;
  }
  .nav-link:hover {
    background-color: #ffcc00;
    color: #111;
    border-color: #ffcc00;
  }
  .nav-link.active {
    background-color: #ffcc00;
    color: #111;
    border-color: #ffcc00;
  }
</style>
</head>
<body>

<div id="header">
  <h2>üèÅ NASCAR Schedule</h2>
  <nav class="nav-bar">
    <a href="index.html" class="nav-link">Live Race Tracker</a>
    <a href="schedules.html" class="nav-link active">Schedule</a>
    <a href="live-points.html" class="nav-link">Live Points</a>
  </nav>
</div>

<h2>Upcoming Races</h2>
<table id="schedule-table">
  <thead>
    <tr>
      <th>Series</th>
      <th>Race</th>
      <th>Track</th>
      <th>Date / Time</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Completed Races</h2>
<table id="completed-table">
  <thead>
    <tr>
      <th>Cup Series</th>
      <th>Xfinity Series</th>
      <th>Truck Series</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const raceListUrl = "https://api.allorigins.win/raw?url=https://cf.nascar.com/cacher/2025/race_list_basic.json";

async function loadSchedule() {
  try {
    const res = await fetch(raceListUrl);
    if (!res.ok) throw new Error("Failed to fetch race list");
    const raceList = await res.json();

    const seriesMap = {
      series_1: "NASCAR Cup Series",
      series_2: "NASCAR Xfinity Series",
      series_3: "NASCAR Craftsman Truck Series"
    };

    const tbody = document.querySelector("#schedule-table tbody");
    tbody.innerHTML = "";

    // --- NEXT RACE TABLE ---
    Object.entries(seriesMap).forEach(([seriesKey, seriesName]) => {
      const races = raceList[seriesKey] || [];
      const now = new Date();

      const upcoming = races
        .map(r => ({ ...r, dateObj: new Date(r.race_date) }))
        .filter(r => r.dateObj > now)
        .sort((a,b) => a.dateObj - b.dateObj);

      if (upcoming.length > 0) {
        const nextRace = upcoming[0];
        const dateTimeStr = nextRace.dateObj.toLocaleString('en-US', {
          month:'2-digit', day:'2-digit', year:'2-digit',
          hour:'numeric', minute:'2-digit', hour12:true
        });
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${seriesName}</td>
          <td>${nextRace.race_name}</td>
          <td>${nextRace.track_name}</td>
          <td>${dateTimeStr}</td>
        `;
        tbody.appendChild(row);
      } else {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${seriesName}</td>
          <td colspan="3"><em>Next Race: Next Season</em></td>
        `;
        tbody.appendChild(row);
      }
    });

    // --- COMPLETED RACES TABLE ---
    const completedTbody = document.querySelector("#completed-table tbody");
    completedTbody.innerHTML = "";

    const completedData = {};
    Object.keys(seriesMap).forEach(key => {
      const races = raceList[key] || [];
      completedData[key] = races
        .map(r => ({ ...r, dateObj: new Date(r.race_date) }))
        .filter(r => r.dateObj < new Date())
        .sort((a,b) => a.dateObj - b.dateObj);
    });

    const maxRows = Math.max(
      completedData.series_1.length,
      completedData.series_2.length,
      completedData.series_3.length
    );

    for (let i = 0; i < maxRows; i++) {
      const cup = completedData.series_1[i];
      const xfin = completedData.series_2[i];
      const truck = completedData.series_3[i];

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${cup ? `${cup.race_name} - ${cup.track_name} (${new Date(cup.race_date).toLocaleDateString()})` : ""}</td>
        <td>${xfin ? `${xfin.race_name} - ${xfin.track_name} (${new Date(xfin.race_date).toLocaleDateString()})` : ""}</td>
        <td>${truck ? `${truck.race_name} - ${truck.track_name} (${new Date(truck.race_date).toLocaleDateString()})` : ""}</td>
      `;
      completedTbody.appendChild(row);
    }

  } catch (err) {
    console.error(err);
    document.querySelector("#schedule-table tbody").innerHTML =
      `<tr><td colspan="4">Error loading schedule.</td></tr>`;
    document.querySelector("#completed-table tbody").innerHTML =
      `<tr><td colspan="3">Error loading completed races.</td></tr>`;
  }
}

loadSchedule();
</script>

</body>
</html>
