<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NASCAR Live Points - Baseline</title>
<style>
  body { font-family: Arial, sans-serif; background:#0a0a0a; color:#fff; margin:0; padding:0; }
  header { text-align:center; background:#111; padding:20px; border-bottom:3px solid #444; }
  header h1 { margin:0; color:#ffcc00; }
  table { width:90%; margin:20px auto; border-collapse:collapse; background:#1a1a1a; border-radius:6px; overflow:hidden; }
  th, td { padding:10px; border-bottom:1px solid #333; text-align:center; }
  th { background:#222; color:#ffcc00; }
  tr:hover { background:#2a2a2a; }
  #updated { text-align:center; margin-bottom:20px; color:#888; font-size:0.9em; }
</style>
</head>
<body>

<header>
  <h1>NASCAR Points Standings</h1>
</header>

<section>
  <h2 style="text-align:center; color:#ffcc00;">üèÜ Points Standings (Cup Series)</h2>
  <table id="points-table">
    <thead>
      <tr>
        <th>Pos</th>
        <th>Driver</th>
        <th>Car</th>
        <th>Points</th>
        <th>Behind Leader</th>
        <th>¬± vs 4th</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<div id="updated"></div>

<script>
const POINTS_FILE = './data/series_1_5580_points.json'; // local JSON

async function updatePoints() {
  try {
    const res = await fetch(POINTS_FILE);
    const points = await res.json();

    const tbody = document.querySelector("#points-table tbody");
    tbody.innerHTML = "";

    const drivers = points.vehicles || points;
    if (!drivers || !drivers.length) return;

    // Sort by points position
    drivers.sort((a,b) => a.points_position - b.points_position);

    const leaderPoints = drivers[0]?.points || 0;
    const fourthPoints = drivers[3]?.points || 0;

    drivers.forEach(d => {
      const behind = d.points_position === 1 ? "Leader" : `-${leaderPoints - d.points}`;
      let vsFourth = "-";
      if (d.points_position <= 8) vsFourth = (d.points - fourthPoints >= 0 ? "+" : "") + (d.points - fourthPoints);

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${d.points_position ?? "-"}</td>
        <td>${d.first_name} ${d.last_name}</td>
        <td>${d.car_number ?? "-"}</td>
        <td>${d.points ?? "-"}</td>
        <td>${behind}</td>
        <td>${vsFourth}</td>
      `;
      tbody.appendChild(row);
    });

    document.getElementById("updated").textContent = "Last updated: " + new Date().toLocaleTimeString();
  } catch(e) {
    console.error("Failed to load points:", e);
    document.getElementById("updated").textContent = "Error loading points data.";
  }
}

// Initial load
updatePoints();

// Update every 8 seconds
setInterval(updatePoints, 8000);
</script>

</body>
</html>
